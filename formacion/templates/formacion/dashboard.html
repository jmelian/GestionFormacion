{% extends 'base.html' %}

{% block content %}

<div class="dashboard-header">
    <h1 class="welcome-title">
        <i class="bi bi-emoji-smile me-2"></i>
        ¬°Bienvenido/a, {{ user.get_full_name|default:user.username }}!
    </h1>
    <p class="welcome-subtitle">
        <i class="bi bi-gear-fill me-2"></i>
        Accede a tus funcionalidades seg√∫n tu perfil y gestiona tu formaci√≥n de manera eficiente.
    </p>
</div>

{# === GENERACI√ìN DE TABS SEG√öN ROLES === #}
<ul class="nav nav-tabs nav-dashboard-tabs" id="dashboardTabs" role="tablist">
    {% if es_empleado %}
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="tab-personal-tab" data-bs-toggle="tab" data-bs-target="#tab-personal" type="button" role="tab" aria-controls="tab-personal" aria-selected="true">
                <i class="bi bi-person-badge-fill me-1"></i> Mi Espacio
            </button>
        </li>
    {% endif %}
    {% if es_empleado or es_formacion or es_rrhh or es_direccion or es_admin %}
        <li class="nav-item" role="presentation">
            <button class="nav-link {% if not es_empleado %}active{% endif %}" id="tab-cursos-tab" data-bs-toggle="tab" data-bs-target="#tab-cursos" type="button" role="tab" aria-controls="tab-cursos" aria-selected="false">
                <i class="bi bi-easel2-fill me-1"></i> Cursos y Formaci√≥n
            </button>
        </li>
    {% endif %}
    {% if es_coordinador %}
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="tab-coordinador-tab" data-bs-toggle="tab" data-bs-target="#tab-coordinador" type="button" role="tab" aria-controls="tab-coordinador" aria-selected="false">
                <i class="bi bi-diagram-3-fill me-1"></i> Mi Departamento
            </button>
        </li>
    {% endif %}
    {% if es_rrhh %}
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="tab-rrhh-tab" data-bs-toggle="tab" data-bs-target="#tab-rrhh" type="button" role="tab" aria-controls="tab-rrhh" aria-selected="false">
                <i class="bi bi-person-badge-fill me-1"></i> RRHH
            </button>
        </li>
    {% endif %}
    {% if es_formacion %}
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="tab-formacion-tab" data-bs-toggle="tab" data-bs-target="#tab-formacion" type="button" role="tab" aria-controls="tab-formacion" aria-selected="false">
                <i class="bi bi-kanban-fill me-1"></i> Gesti√≥n
            </button>
        </li>
    {% endif %}
    {% if es_direccion %}
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="tab-direccion-tab" data-bs-toggle="tab" data-bs-target="#tab-direccion" type="button" role="tab" aria-controls="tab-direccion" aria-selected="false">
                <i class="bi bi-graph-up-arrow me-1"></i> Direcci√≥n
            </button>
        </li>
    {% endif %}
    {% if es_admin %}
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="tab-admin-tab" data-bs-toggle="tab" data-bs-target="#tab-admin" type="button" role="tab" aria-controls="tab-admin" aria-selected="false">
                <i class="bi bi-gear-wide-connected me-1"></i> Administraci√≥n
            </button>
        </li>
    {% endif %}
</ul>

<div class="tab-content dashboard-tabs-content" id="dashboardTabsContent">

    {# TAB: MI ESPACIO PERSONAL #}
    {% if es_empleado %}
    <div class="tab-pane fade show active" id="tab-personal" role="tabpanel" aria-labelledby="tab-personal-tab" tabindex="0">
        <div class="dashboard-section-title"><i class="bi bi-person-badge-fill"></i> Mi Espacio Personal</div>
        <div class="dashboard-grid">
            <div class="dashboard-card card-empleado">
                <span class="card-icon">üë§</span>
                <h3 class="card-title">Mi Perfil Personal</h3>
                <p class="card-description">Visualiza y consulta tus datos personales, informaci√≥n de contacto y detalles profesionales.</p>
                <a href="{% url 'formacion:perfil_empleado_visualizar' %}" class="card-link">
                    <i class="bi bi-person-lines-fill"></i> Acceder al perfil
                </a>
            </div>
            <div class="dashboard-card card-empleado">
                <span class="card-icon">üéì</span>
                <h3 class="card-title">Mi Formaci√≥n</h3>
                <p class="card-description">Gestiona tus titulaciones, certificaciones y registra otros cursos realizados fuera de la empresa.</p>
                <a href="{% url 'formacion:mis_titulaciones_list' %}" class="card-link">
                    <i class="bi bi-mortarboard-fill"></i> Gestionar formaci√≥n
                </a>
            </div>
            <div class="dashboard-card card-empleado">
                <span class="card-icon">üìò</span>
                <h3 class="card-title">Mis Cursos</h3>
                <p class="card-description">Consulta tu historial formativo, progreso actual y certificados obtenidos en los cursos completados.</p>
                <a href="{% url 'formacion:mis_cursos' %}" class="card-link">
                    <i class="bi bi-journal-bookmark-fill"></i> Ver historial
                </a>
            </div>
        </div>
    </div>
    {% endif %}

    {# TAB: CURSOS Y FORMACI√ìN #}
    {% if es_empleado or es_formacion or es_rrhh or es_direccion or es_admin %}
    <div class="tab-pane fade {% if not es_empleado %}show active{% endif %}" id="tab-cursos" role="tabpanel" aria-labelledby="tab-cursos-tab" tabindex="0">
        <div class="dashboard-section-title"><i class="bi bi-easel2-fill"></i> Cursos y Formaci√≥n</div>
        <div class="dashboard-grid">
            {% if es_empleado %}
            <div class="dashboard-card card-empleado">
                <span class="card-icon">üìÖ</span>
                <h3 class="card-title">Pr√≥ximos Cursos</h3>
                <p class="card-description">Descubre los cursos disponibles pr√≥ximamente y mantente al d√≠a con las oportunidades formativas.</p>
                <a href="{% url 'formacion:proximos_cursos' %}" class="card-link">
                    <i class="bi bi-calendar-event-fill"></i> Explorar cursos
                </a>
            </div>
            <div class="dashboard-card card-empleado">
                <span class="card-icon">üìã</span>
                <h3 class="card-title">Cursos Obligatorios</h3>
                <p class="card-description">Consulta los cursos de formaci√≥n que son obligatorios para tu puesto o de forma general, y solicita tu inscripci√≥n.</p>
                <a href="{% url 'formacion:cursos_obligatorios_lista' %}" class="card-link">
                    <i class="bi bi-list-check"></i> Ver Cursos Obligatorios
                </a>
            </div>
            {% endif %}
            {% if es_formacion or es_rrhh or es_direccion or es_admin %}
            <div class="dashboard-card card-formacion">
                <span class="card-icon">üìã</span>
                <h3 class="card-title">Estado de Cursos</h3>
                <p class="card-description">Consulta el estado general de todos los cursos, participantes y m√©tricas de progreso formativo.</p>
                <a href="{% url 'formacion:estado_cursos' %}" class="card-link">
                    <i class="bi bi-clipboard-data-fill"></i> Ver estado general
                </a>
            </div>
            <div class="dashboard-card card-formacion">
                <span class="card-icon">üìä</span>
                <h3 class="card-title">Formaci√≥n por Empleado</h3>
                <p class="card-description">Visualiza las formaciones y titulaciones de cada empleado, con filtros por departamento y b√∫squeda.</p>
                <a href="{% url 'formacion:empleados_con_formacion' %}" class="card-link">
                    <i class="bi bi-people-fill"></i> Consultar empleados
                </a>
            </div>
            <div class="dashboard-card card-formacion">
                <span class="card-icon">üìö</span>
                <h3 class="card-title">Gesti√≥n de Cursos</h3>
                <p class="card-description">Crea, edita y gestiona los cursos y programas de formaci√≥n internos de la empresa.</p>
                
                {# This link makes the entire card clickable and takes you to the main HR course list #}
                <a href="{% url 'formacion:gestion_cursos_list' %}" class="card-link-full-area">
                    <span class="visually-hidden">Gestionar Cursos</span> 
                </a>

                {# This is the specific link for creating a new course #}
                <a href="{% url 'formacion:crear_curso' %}" class="card-link">
                    <i class="bi bi-plus-circle-fill"></i> Crear Nuevo Curso
                </a>
            </div>
            {% endif %}
        </div>
    </div>
    {% endif %}

    {# TAB: COORDINADOR #}
    {% if es_coordinador %}
    <div class="tab-pane fade" id="tab-coordinador" role="tabpanel" aria-labelledby="tab-coordinador-tab" tabindex="0">
        <div class="dashboard-section-title"><i class="bi bi-diagram-3-fill"></i> Gesti√≥n de Departamento</div>
        <div class="dashboard-grid">
            <div class="dashboard-card card-coordinador">
                <span class="card-icon">üë•</span>
                <h3 class="card-title">Mi Departamento</h3>
                <p class="card-description">Revisa y gestiona la formaci√≥n de tu equipo, supervisa el progreso y coordina las actividades formativas.</p>
                <a href="{% url 'formacion:equipo_departamento' %}" class="card-link">
                    <i class="bi bi-diagram-3-fill"></i> Gestionar equipo
                </a>
            </div>
            <div class="dashboard-card card-coordinador">
                <span class="card-icon">‚úÖ</span>
                <h3 class="card-title">Preselecci√≥n</h3>
                <p class="card-description">Prop√≥n empleados de tu departamento para formaciones futuras y gestiona las recomendaciones.</p>
                <a href="{% url 'formacion:preseleccionar_empleado' %}" class="card-link">
                    <i class="bi bi-person-check-fill"></i> Preseleccionar empleados
                </a>
            </div>
            <div class="dashboard-card card-solicitud-curso">
                <span class="card-icon">üí°</span>
                <h3 class="card-title">Solicitar Formaci√≥n</h3>
                <p class="card-description">Env√≠a una propuesta para un nuevo curso o programa de capacitaci√≥n para tu equipo o departamento.</p>
                <a href="{% url 'formacion:solicitar_curso' %}" class="card-link">
                    <i class="bi bi-send-fill"></i> Enviar Solicitud de Curso
                </a>
            </div>
        </div>
    </div>
    {% endif %}

    {# TAB: RRHH #}
    {% if es_rrhh %}
    <div class="tab-pane fade" id="tab-rrhh" role="tabpanel" aria-labelledby="tab-rrhh-tab" tabindex="0">
        <div class="dashboard-section-title"><i class="bi bi-person-badge-fill"></i> Recursos Humanos</div>
        <div class="dashboard-grid">
            <div class="dashboard-card card-rrhh">
                <span class="card-icon">üìÑ</span>
                <h3 class="card-title">Validaci√≥n de Certificados</h3>
                <p class="card-description">Valida y aprueba las formaciones recibidas por empleados, gestiona certificaciones externas.</p>
                <a href="{% url 'formacion:titulaciones_pendientes_rrhh' %}" class="card-link">
                    <i class="bi bi-patch-check-fill"></i> Validar certificados
                </a>
            </div>
            <div class="dashboard-card card-rrhh">
                <span class="card-icon">üóÇÔ∏è</span>
                <h3 class="card-title">Validar Cursos Obligatorios</h3>
                <p class="card-description">Revisa y gestiona las solicitudes de inscripci√≥n de los empleados a cursos obligatorios que est√°n pendientes de tu aprobaci√≥n.</p>
                <a href="{% url 'formacion:gestionar_solicitudes_obligatorias_rrhh' %}" class="card-link">
                    <i class="bi bi-check2-square"></i> Gestionar Solicitudes
                </a>
            </div>
        </div>
    </div>
    {% endif %}

    {# TAB: GESTI√ìN #}
    {% if es_formacion or es_rrhh or es_direccion%}
    <div class="tab-pane fade" id="tab-formacion" role="tabpanel" aria-labelledby="tab-formacion-tab" tabindex="0">
        <div class="dashboard-section-title"><i class="bi bi-list-check"></i> Gesti√≥n de Preselecciones</div>
        <div class="dashboard-grid">
            <div class="dashboard-card card-formacion">
                <span class="card-icon">üìä</span>
                <h3 class="card-title">Gesti√≥n de Preselecciones</h3>
                <p class="card-description">Consulta y confirma las preselecciones realizadas por coordinadores para cada curso disponible.</p>
                <a href="{% url 'formacion:confirmar_preseleccionados_lista' %}" class="card-link">
                    <i class="bi bi-list-check"></i> Gestionar preselecciones
                </a>
            </div>
            <div class="dashboard-card card-rrhh">
                <span class="card-icon">üìã</span>
                <h3 class="card-title">Solicitudes de Curso</h3>
                <p class="card-description">Revisa y gestiona las solicitudes de formaci√≥n enviadas por los coordinadores.</p>
                <a href="{% url 'formacion:solicitudes_curso_gestion' %}" class="card-link">
                    <i class="bi bi-list-check"></i> Ver Solicitudes
                </a>
            </div>
        </div>
    </div>
    {% endif %}

    {# TAB: DIRECCI√ìN #}
    {% if es_direccion %}
    <div class="tab-pane fade" id="tab-direccion" role="tabpanel" aria-labelledby="tab-direccion-tab" tabindex="0">
        <div class="dashboard-section-title"><i class="bi bi-graph-up-arrow"></i> Direcci√≥n</div>
        <div class="dashboard-grid">
            <div class="dashboard-card card-direccion">
                <span class="card-icon">üìà</span>
                <h3 class="card-title">Panel de Direcci√≥n</h3>
                <p class="card-description">Accede a informes ejecutivos, m√©tricas de formaci√≥n y an√°lisis del estado general de la organizaci√≥n.</p>
                <a href="{% url 'admin:index' %}" class="card-link">
                    <i class="bi bi-graph-up-arrow"></i> Panel ejecutivo
                </a>
            </div>
        </div>
    </div>
    {% endif %}

    {# TAB: ADMINISTRACI√ìN #}
    {% if es_admin %}
    <div class="tab-pane fade" id="tab-admin" role="tabpanel" aria-labelledby="tab-admin-tab" tabindex="0">
        <div class="dashboard-section-title"><i class="bi bi-gear-wide-connected"></i> Administraci√≥n</div>
        <div class="dashboard-grid">
            <div class="dashboard-card card-admin">
                <span class="card-icon">üõ†Ô∏è</span>
                <h3 class="card-title">Administraci√≥n del Sistema</h3>
                <p class="card-description">Acceso completo al backend de Django para configuraci√≥n avanzada y gesti√≥n del sistema.</p>
                <a href="{% url 'admin:index' %}" class="card-link">
                    <i class="bi bi-gear-wide-connected"></i> Panel de administraci√≥n
                </a>
            </div>
            <div class="dashboard-card card-rrhh">
                <span class="card-icon">üë§</span>
                <h3 class="card-title">Registro de Empleados</h3>
                <p class="card-description">Registra nuevos empleados en el sistema y configura sus perfiles y permisos iniciales.</p>
                <a href="{% url 'formacion:alta_usuario_empleado' %}" class="card-link">
                    <i class="bi bi-person-plus-fill"></i> Registrar empleado
                </a>
            </div>
        </div>
    </div>
    {% endif %}

</div>
{% endblock %}